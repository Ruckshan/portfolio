{"ast":null,"code":"/**\r\n * Serverless funciton for /api/posts.\r\n * Fetches posts from DEV.to with given params.\r\n */\nexport default (async (req, res) => {\n  try {\n    const {\n      page,\n      per_page,\n      tag\n    } = req.query;\n    const posts = await getPosts({\n      page: String(page),\n      per_page: String(per_page),\n      tag: String(tag)\n    });\n    res.status(200).json(posts);\n  } catch (e) {\n    res.status(500).send('Internal Server Error.');\n  }\n});\n/**\r\n * Props for {@link getPosts}.\r\n */\n\n/**\r\n * Retrieves a list of articles from DEV.to for matching query params.\r\n * @param param of type {@link GetPostsProps}.\r\n */\nexport async function getPosts({\n  page = '1',\n  per_page = process.env.POSTS_PER_PAGE,\n  tag = ''\n} = {}) {\n  const url = `https://dev.to/api/articles?`;\n  const params = new URLSearchParams({\n    page: '1',\n    per_page: '100'\n  });\n  console.log(url + params);\n  const headers = new Headers();\n  headers.append('api-key', process.env.DEV_TO_TOKEN);\n  const response = await fetch(url + params);\n  let posts = await response.json();\n  posts = posts.filter(post => {\n    return (tag ? post.tag_list.includes(tag) : true) && !post.tag_list.includes('nuggets');\n  });\n  const start = (+page - 1) * +per_page;\n  const end = start + +per_page;\n  console.log('Start: ', start, ' End: ', end);\n  posts = posts.slice(start, end);\n  return posts;\n}","map":null,"metadata":{},"sourceType":"module"}